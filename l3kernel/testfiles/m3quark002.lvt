%
% Copyright (C) 2020 The LaTeX3 project
%

\documentclass{minimal}
\input{regression-test}
\RequirePackage[enable-debug]{expl3}
\ExplSyntaxOn
\debug_on:n { check-declarations , deprecation , log-functions }
\ExplSyntaxOff

\begin{document}

\START
\AUTHOR{Phelype Oleinik}
\ExplSyntaxOn

\TEST{New~private~quark~functions}{
  \quark_new:N \q__test_recursion_tail
  \quark_new:N \q__test_recursion_stop
  \__kernel_quark_new_recursion_tail_stop:n { __test }
  \cs_log:N \__test_quark_if_recursion_tail_stop:n
  \__kernel_quark_new_recursion_tail_stop_do:n { __test }
  \cs_log:N \__test_quark_if_recursion_tail_stop_do:nn
}

\TESTEXP{Inside~recursions~(expect~nothing)}{
  \__test_quark_if_recursion_tail_stop:n
    {\q__test_recursion_tail} \ERROR \q__test_recursion_stop
}

\TESTEXP{Inside~recursions~(expect~`YESYES')}{
  \__test_quark_if_recursion_tail_stop_do:nn
    {\q__test_recursion_tail}\YES\q__test_recursion_stop
  \__test_quark_if_recursion_tail_stop_do:nn
    {\q__test_recursion_tail}\YES\NO\q__test_recursion_stop
}

\TESTEXP{Recursion~edge~cases~(expect~nothing)}{
  \__test_quark_if_recursion_tail_stop:n {{{{a}}}}
  \__test_quark_if_recursion_tail_stop:n {{ab\iffalse}\fi}
}

\END
